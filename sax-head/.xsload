#!/bin/sh

BUILD_ROOT=$1

if [ -f "/usr/X11R6/bin/xsload" ];then
	MD=/usr/X11R6/lib/modules/drivers
	for i in ati_drv radeon_drv atimisc_drv r128_drv;do
		test -f $MD/$i.so && mv $MD/$i.so /tmp
		test -f $MD/$i.o && mv $MD/$i.o /tmp
	done
	/usr/X11R6/bin/xsload > /tmp/CardModules
	if [ -f /etc/X11/CardModules.addon ];then
		cat /etc/X11/CardModules.addon >> /tmp/CardModules
	else
		echo "Warning addon options not found"
		echo "package xorg-x11-driver-options is missing ?"
	fi
	cp /tmp/CardModules \
		$BUILD_ROOT/usr/share/sax/api/data/CardModules
	for i in ati_drv radeon_drv atimisc_drv r128_drv;do
		test -f /tmp/$i.so && mv /tmp/$i.so $MD
		test -f /tmp/$i.o && mv /tmp/$i.o $MD
	done
	exit 0
fi
